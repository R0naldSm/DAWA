
<section class="mt-4 d-flex flex-column align-items-center min-vh-100">

	<div>
		<form [formGroup]="formBusqueda" class="mb-4 w-auto align-self-start text-start">
			<h2 class="mb-4">Lista de Productos</h2>

			<div *ngIf="cargando" class="alert alert-info py-2">Cargando productos...</div>
			<div *ngIf="error" class="alert alert-danger py-2">{{ error }}</div>

			<label class="form-label">Buscar proveedor (id o texto)</label>
			<input formControlName="proveedor" type="text" class="form-control" />
			<div class="d-flex align-items-center gap-3 mt-3">
				<button class="btn btn-success btn-sm" (click)="irCrear()">Crear producto</button>
				<div class="form-check form-switch">
					<input
						class="form-check-input"
						type="checkbox"
						role="switch"
						id="switchInactivosProductos"
						[(ngModel)]="verInactivos"
						(ngModelChange)="toggleVista()"
						[ngModelOptions]="{ standalone: true }">
					<label class="form-check-label fw-bold text-secondary" for="switchInactivosProductos">
						{{ verInactivos ? 'Ver solo inactivos' : 'Ver activos' }}
					</label>
				</div>
			</div>
		</form>

		<table class="table table-hover border shadow p-3 mb-4 bg-body-tertiary w-100" style="min-width: 1200px;">
			<thead>
				<tr class="text-center">
					<th scope="col">#</th>
					<th scope="col">ID Proveedor</th>
					<th scope="col">Nombre</th>
					<th scope="col">Descripción</th>
					<th scope="col">Unidad</th>
					<th scope="col">Precio</th>
					<th scope="col">Acciones</th>
				</tr>
			</thead>

			<tbody>
				@for (p of productos().slice((pagina - 1) * 10, (pagina - 1) * 10 + 10); track p.id) {
					<tr>
						<td scope="row">{{p.id}}</td>
						<td>{{p.proveedorId}}</td>
						<td>{{p.nombre}}</td>
						<td class="text-truncate" style="max-width: 260px;">{{ p.descripcion || '-' }}</td>
						<td>{{p.unidadMedida}}</td>
						<td>$ {{p.precio}}</td>
						<td class="d-flex gap-2">
							<button class="btn btn-outline-primary btn-sm" (click)="editar(p.id)">Editar</button>
							<button *ngIf="!verInactivos" class="btn btn-danger btn-sm" (click)="eliminar(p.id)">Eliminar</button>
							<button *ngIf="verInactivos" class="btn btn-success btn-sm" (click)="activar(p.id)">Activar</button>
						</td>
					</tr>
				}
			</tbody>
		</table>
		<div *ngIf="productos().length === 0" class="text-muted mb-4">
			{{ verInactivos ? 'No hay productos inactivos.' : 'No se encontraron productos activos.' }}
		</div>
	</div>

	<div class="mt-auto py-3 d-flex align-items-center gap-3">
		<button class="btn btn-secondary btn-sm" (click)="anterior()">Anterior</button>
		<span> Página {{pagina}} de {{ totalPaginas() }} </span>
		<button class="btn btn-secondary btn-sm" (click)="siguiente()">Siguiente</button>
	</div>

</section>
